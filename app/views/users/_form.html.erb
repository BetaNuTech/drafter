<%= form_with(model: user, local: true) do |form| %>
  <%= render partial: 'shared/object_errors', locals: { object: user, object_name: 'User' } %>

  <div class="row">
    <div class="col-md-12">
      <fieldset>
        <legend>Login Information</legend>

          <div class="row">
            <div class="col">
            </div>
          </div>

          <% if policy(user).deactivate? %>
            <div class="row">
              <div class="col">
                <div class="form-check">
                  <%= form.check_box :active, class: 'form-check-input' %>
                  <label class="form-check-label" for="user_active">Active?</label>
                  <% unless user.confirmed? %>
                    <span class="badge bg-warning">unconfirmed</span>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>

        <div class="row">
          <div class="col-md-8 form-group">
            <%= form.label :email %>
            <%= form.text_field :email, class: "form-control form-control-lg" %>
            <% unless user.new_record? %>
              <small class="bg-light">
                <em>
                ( Note that changes here are only applied after email confirmation )
                </em>
              </small>
            <% end %>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 form-group">
            <%= form.label :timezone %>
            <%= form.time_zone_select :timezone, ActiveSupport::TimeZone.us_zones, { default: "Pacific Time (US & Canada)" }, {class: "form-control"} %>
          </div>
        </div>
        <% unless user.new_record? %>
          <div class="row">
            <div class="col-sm-12 col-md-6 form-group">
              <%= form.label :password %>
              <%= form.password_field :password, class: "form-control" %>
            </div>
            <div class="col-sm-12 col-md-6 form-group">
              <%= form.label :password_confirmation %>
              <%= form.password_field :password_confirmation, class: "form-control" %>
            </div>
          </div>
        <% end %>
          <div class="row">
          <% if policy(user).assign_to_role? %>
            <div class="col-sm-12 col-md-6 form-group">
              <%= form.label :role_id, 'Role' %><br/>
              <%= form.select :role_id, role_options_for_select(user), {}, { class: "form-select form-select" } %>
            </div>
          <% end %>
          <% if policy(user).assign_to_organization? %>
            <div class="col-sm-12 col-md-6 form-group">
              <%= form.label :organization_id, 'Organization' %><br/>
              <%= form.select :organization_id, organization_options_for_select(user), {include_blank: true}, { class: "form-select form-select" } %>
            </div>
          <% end %>
          </div>
      </fieldset>
    </div>
  </div>

  <%= form.fields_for :profile do |profile_form| %>
  <div class="row">
    <div class="col">
      <fieldset>
        <legend>Profile</legend>
          <div class="row">
            <div class="col-sm-12 col-md-2 form-group">
              <%= profile_form.label "Prefix" %>
              <%= profile_form.text_field :name_prefix, {class: "form-control"} %>
            </div>
            <div class="col-sm-12 col-md-4 form-group">
              <%= profile_form.label "First Name" %>
              <%= profile_form.text_field :first_name, {class: "form-control"} %>
            </div>
            <div class="col-sm-12 col-md-4 form-group">
              <%= profile_form.label "Last Name" %>
              <%= profile_form.text_field :last_name, {class: "form-control"} %>
            </div>
            <div class="col-sm-12 col-md-2 form-group">
              <%= profile_form.label "Suffix" %>
              <%= profile_form.text_field :name_suffix, {class: "form-control"} %>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12 col-md-6 form-group">
              <%= profile_form.label :company %>
              <%= profile_form.text_field :company, {class: "form-control" } %>
            </div>
            <div class="col-sm-12 col-md-6 form-group">
              <%= profile_form.label :title %>
              <%= profile_form.text_field :title, {class: "form-control" } %>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12 col-md-6 form-group">
              <%= profile_form.label :phone %>
              <%= profile_form.text_field :phone, {type: "tel", class: "form-control" } %>
            </div>
          </div>
          <div class="row">
            <div class="col form-group">
              <%= profile_form.label :notes %>
              <%= profile_form.text_area :notes, {class: "form-control"} %>
            </div>
          </div>
      </fieldset>
    </div>
  </div>
  <% end %>

  <div class="row">
    <div class="col-10 form-group">
      <button type="submit" class="btn btn-lg btn-success">Save</button>
      <%= link_to 'Back', ( policy(User).index? ? users_path : :back ), class: "btn btn-sm btn-info" %>
    </div>
  </div>
<% end # Form %>

<% if policy(user).destroy? %>
  <div class="row">
    <div class="col"></div>
    <div class="col-auto form-group">
      <%= link_to('Delete', user_path(user), class: 'btn btn-danger', data: { turbo_confirm: 'Are you sure?', turbo_method: :delete}) %>
    </div>
  </div>
<% end %>

